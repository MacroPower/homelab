# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-spec/master/schema/compose-spec.json
services:
  talos:
    image: ghcr.io/siderolabs/talos:v1.11.5
    container_name: talos
    hostname: knas01
    tty: true
    read_only: true
    privileged: true
    restart: always
    cap_add:
      - NET_ADMIN
      - NET_RAW
      - SYS_ADMIN
      - SYS_PTRACE
      - SYS_RESOURCE
      - SYSLOG
    security_opt:
      - seccomp=unconfined
    environment:
      - PLATFORM=container
    devices:
      - /dev/kmsg
    tmpfs:
      - /run
      - /system
      - /tmp
    volumes:
      - talos_system_state:/system/state
      - talos_var:/var
      - talos_cni:/etc/cni
      - talos_kubernetes:/etc/kubernetes
      - talos_libexec:/usr/libexec/kubernetes
      - talos_opt:/opt
      - /sys/fs/bpf:/sys/fs/bpf:rshared
      - /mnt/main/containers/talos/var/openebs/local:/var/openebs/local:rshared
      - /mnt/main/media/video/anime:/var/media/video/anime:rshared
      - /mnt/main/media/video/tv:/var/media/video/tv:rshared
      - /mnt/main/media/video/movies:/var/media/video/movies:rshared
    networks:
      shared_macvlan:
        ipv4_address: "10.10.12.1"
        ipv6_address: "fc42:0:0:a::1201"
        mac_address: "e4:dd:9a:b9:42:89"
    dns:
      - "10.10.0.1"
      - "fc42:0:0:a::"
    mem_limit: 32g
    mem_reservation: 8g
volumes:
  talos_system_state: {}
  talos_var: {}
  talos_cni: {}
  talos_kubernetes: {}
  talos_libexec: {}
  talos_opt: {}
networks:
  shared_macvlan:
    external: true
    name: shared_macvlan
