apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kube-system

helmCharts:
  - name: external-dns
    repo: https://kubernetes-sigs.github.io/external-dns
    version: "1.12.2"
    releaseName: external-dns
    valuesInline:
      env:
        - name: EXTERNAL_DNS_RFC2136_TSIG_SECRET
          valueFrom:
            secretKeyRef:
              name: external-dns-credentials
              key: EXTERNAL_DNS_RFC2136_TSIG_SECRET
      sources:
        - ingress
        - service
      policy: upsert-only
      provider: rfc2136
      extraArgs:
        - --rfc2136-host=10.0.0.1
        - --rfc2136-port=53
        - --rfc2136-zone=home.macro.network
        - --rfc2136-tsig-keyname=home.macro.network
        - --rfc2136-tsig-secret-alg=hmac-sha256
        # - --rfc2136-tsig-axfr
      logLevel: debug

resources:
  - secrets.yaml
