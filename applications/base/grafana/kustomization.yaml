apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: observability

helmCharts:
- name: grafana
  repo: https://grafana.github.io/helm-charts
  version: 6.39.0
  releaseName: grafana
  namespace: observability
  valuesInline:
    annotations:
      "sidecar.jaegertracing.io/inject": "true"
    env:
      JAEGER_AGENT_HOST: localhost
      JAEGER_AGENT_PORT: '6831'
      ANALYTICS_REPORTING_ENABLED: 'false'

    sidecar:
      alerts:
        enabled: false
        label: grafana_alert
      dashboards:
        enabled: true
        label: grafana_dashboard
        provider:
          allowUiUpdates: true
      datasources:
        enabled: true
        label: grafana_datasource
      plugins:
        enabled: true
        label: grafana_plugin

configMapGenerator:
  - name: grafana-dashboard-grafana-cloud-usage
    behavior: add
    files:
      - grafana-cloud-usage.json=dashboards/grafana-cloud-usage.json

  - name: grafana-dashboard-k8s-home
    behavior: add
    files:
      - k8s-home.json=dashboards/k8s-home.json

generatorOptions:
  labels:
    grafana_dashboard: '1'
