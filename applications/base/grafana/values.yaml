env:
  ANALYTICS_REPORTING_ENABLED: "false"
  GF_SERVER_PROTOCOL: http
  GF_SERVER_DOMAIN: grafana.home.macro.network
  GF_SERVER_ROOT_URL: https://grafana.home.macro.network
  GF_TRACING_OPENTELEMETRY_JAEGER_ADDRESS: http://linkerd-collector.linkerd-jaeger.svc.cluster.local:14268/api/traces
  GF_TRACING_OPENTELEMETRY_JAEGER_PROPAGATION: w3c # TODO: Change this to "b3"
  GF_AUTH_GENERIC_OAUTH_ENABLED: "true"
  GF_AUTH_GENERIC_OAUTH_NAME: "authentik"
  GF_AUTH_GENERIC_OAUTH_SCOPES: "openid profile email"
  GF_AUTH_GENERIC_OAUTH_TLS_SKIP_VERIFY_INSECURE: "true"
  GF_AUTH_GENERIC_OAUTH_AUTH_URL: "https://authentik.home.macro.network/application/o/authorize/"
  GF_AUTH_GENERIC_OAUTH_TOKEN_URL: "https://authentik.home.macro.network/application/o/token/"
  GF_AUTH_GENERIC_OAUTH_API_URL: "https://authentik.home.macro.network/application/o/userinfo/"
  GF_AUTH_SIGNOUT_REDIRECT_URL: "https://authentik.home.macro.network/application/o/grafana/end-session/"
  # Optionally enable auto-login (bypasses Grafana login screen)
  GF_AUTH_OAUTH_AUTO_LOGIN: "true"
  # Optionally map user groups to Grafana roles
  GF_AUTH_GENERIC_OAUTH_ROLE_ATTRIBUTE_PATH: >
    contains(groups[*], 'Grafana Admins') && 'Admin' || contains(groups[*], 'Grafana Editors') && 'Editor' || 'Viewer'

envValueFrom:
  GF_AUTH_GENERIC_OAUTH_CLIENT_ID:
    secretKeyRef:
      name: authentik-grafana
      key: grafana_client_id
  GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET:
    secretKeyRef:
      name: authentik-grafana
      key: grafana_client_secret

admin:
  existingSecret: grafana-credentials
  userKey: GRAFANA_ADMIN_USER
  passwordKey: GRAFANA_ADMIN_PASS

sidecar:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 128Mi
  alerts:
    enabled: false
    label: grafana_alert
  dashboards:
    enabled: true
    label: grafana_dashboard
    searchNamespace: ALL
    provider:
      allowUiUpdates: true
  datasources:
    enabled: true
    label: grafana_datasource
  plugins:
    enabled: true
    label: grafana_plugin

resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    memory: 128Mi
