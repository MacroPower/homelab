config:
  inputs: |
    [INPUT]
        Name tail
        Path /var/log/containers/*.log
        multiline.parser docker, cri
        Tag kube.*
        Mem_Buf_Limit 10MB
        Skip_Long_Lines On
    [INPUT]
        Name systemd
        Path /var/log/journal
        Tag host.*
        Systemd_Filter _SYSTEMD_UNIT=kubelet.service
        Systemd_Filter _SYSTEMD_UNIT=k3s.service
        Systemd_Filter _SYSTEMD_UNIT=k3s-agent.service
        Read_From_Tail On
  outputs: |
    [OUTPUT]
        Name        loki
        Match       *
        Host        logs-prod-us-central1.grafana.net
        port        443
        tls         on
        tls.verify  on
        http_user   ${GRAFANA_CLOUD_LOKI_USER}
        http_passwd ${GRAFANA_CLOUD_LOKI_PASS}

        labels job=fluentbit
        auto_kubernetes_labels on
dashboards:
  enabled: true
  labelKey: grafana_dashboard
  namespace: observability
env:
  - name: GRAFANA_CLOUD_LOKI_USER
    valueFrom:
      secretKeyRef:
        key: GRAFANA_CLOUD_LOKI_USER
        name: fluent-bit-credentials
  - name: GRAFANA_CLOUD_LOKI_PASS
    valueFrom:
      secretKeyRef:
        key: GRAFANA_CLOUD_LOKI_PASS
        name: fluent-bit-credentials
logLevel: info
resources:
  limits:
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 256Mi
serviceMonitor:
  enabled: false
tolerations:
  - effect: NoSchedule
    operator: Exists
  - key: CriticalAddonsOnly
    operator: Exists
  - effect: NoExecute
    operator: Exists
