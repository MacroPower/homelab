apiVersion: v1
kind: ConfigMap
metadata:
  name: rclone-init-scripts
data:
  init.sh: |
    # Stop any previous jobs.
    curl -v -X POST -H 'Content-Type: application/json' -d '{
    }' http://transmission-webdav-rclone.transmission.svc.cluster.local:5572/job/stopgroup?group=job/webdav

    OUTPUT=$(
    curl -v -X POST -H 'Content-Type: application/json' -d '{
      "_async": true,
      "_group": "job/webdav",
      "command": "serve",
      "arg": ["webdav", "/userdata"],
      "opt": {
        "addr": ":50000"
      }
    }' http://transmission-webdav-rclone.transmission.svc.cluster.local:5572/core/command
    )

    # Shutdown linkerd.
    curl -v -X POST -d '{"hello":"shutdown"}' http://localhost:4191/shutdown

    echo $OUTPUT

    echo $OUTPUT | grep "jobid"
