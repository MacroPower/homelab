apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kube-system

helmCharts:
  - name: traefik
    repo: https://helm.traefik.io/traefik
    version: 10.30.1
    releaseName: traefik
    includeCRDs: true
    valuesInline:
      deployment:
        kind: Deployment
        replicas: 1

        annotations:
          'sidecar.jaegertracing.io/inject': 'true'

      tracing:
        jaeger:
          samplingServerURL: http://localhost:5778/sampling
          samplingType: const
          samplingParam: 1.0
          localAgentHostPort: 127.0.0.1:6831

      providers:
        kubernetesIngress:
          enabled: true
          publishedService:
            enabled: true
            pathOverride: 'kube-system/traefik'

      service:
        annotations:
          'load-balancer.hetzner.cloud/ipv6-disabled': 'true'
          'load-balancer.hetzner.cloud/disable-private-ingress': 'true'

      ports:
        websecure:
          tls:
            enabled: true

      tlsStore:
        default:
          defaultCertificate:
            secretName: cloudflare-tls

      tlsOptions:
        default:
          clientAuth:
            secretNames:
              - cloudflare-mtls
            clientAuthType: RequireAndVerifyClientCert
