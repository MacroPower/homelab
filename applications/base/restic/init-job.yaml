apiVersion: batch/v1
kind: Job
metadata:
  name: rclone-init-scripts
  labels:
    'app': rclone
    'app.kubernetes.io/instance': rclone
    'release': single
  annotations:
    'helm.sh/hook': post-install
    'helm.sh/hook-delete-policy': hook-succeeded
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: init-restic
          image: curlimages/curl:7.86.0
          command: ['sh', '/scripts/init-restic.sh']
          volumeMounts:
            - name: init-scripts
              mountPath: /scripts
      volumes:
        - name: init-scripts
          configMap:
            name: rclone-init-scripts
            optional: false
