apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: backup

helmCharts:
  - name: k8up
    repo: https://k8up-io.github.io/k8up
    version: '4.0.1'
    releaseName: k8up
    namespace: backup
    includeCRDs: true
    valuesInline:
      k8up:
        envVars:
          - name: BACKUP_GLOBAL_OPERATOR_NAMESPACE
            value: backup

      metrics:
        service:
          port: 8080
          type: ClusterIP
          # -- Service node port of the metrics endpoint, requires `metrics.service.type=NodePort`
          nodePort: 0
          # -- Annotations to add to the service
          annotations: {}

        serviceMonitor:
          # -- Whether to enable ServiceMonitor manifests for
          # [Prometheus Operator][prometheus-operator]
          enabled: true
          # -- Scrape interval to collect metrics
          scrapeInterval: 60s
          # -- If the object should be installed in a different namespace than operator
          namespace: ''
          # -- Add labels to the ServiceMonitor object
          additionalLabels: {}
        prometheusRule:
          # -- Whether to enable PrometheusRule manifest for
          # [Prometheus Operator][prometheus-operator]
          enabled: true
          # -- If the object should be installed in a different namespace than operator
          namespace: ''
          # -- Add labels to the PrometheusRule object
          additionalLabels: {}
          # -- Whether the default rules should be installed
          createDefaultRules: true
          # -- Create default rules for the given job types.
          # Valid values are "archive", "backup", "check", "prune", and "restore".
          jobFailedRulesFor: ['archive', 'backup', 'check', 'prune', 'restore']
          # -- Provide additional alert rules in addition to the defaults
          additionalRules: []

resources:
  - https://github.com/k8up-io/k8up/releases/download/k8up-4.0.1/k8up-crd.yaml
