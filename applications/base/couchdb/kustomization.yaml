apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: data

helmCharts:
  - name: couchdb
    repo: https://apache.github.io/couchdb-helm
    version: '3.6.1'
    releaseName: single
    namespace: data
    valuesInline:
      clusterSize: 1

      createAdminSecret: false

      couchdbConfig:
        couchdb:
          uuid: e40e2b0a6fb242339a9a089070c1bc46
        chttpd:
          bind_address: any
          require_valid_user: true
          enable_cors: true
        httpd:
          WWW-Authenticate: 'Basic realm="administrator"'
        cors:
          credentials: true
          origins: 'http://localhost, https://localhost, https://6.nomie.app'

      persistentVolume:
        enabled: true
        storageClass: 'hcloud-volumes'
        size: 10Gi
        accessModes:
          - ReadWriteOnce

      prometheusPort:
        enabled: true
        bind_address: '0.0.0.0'
        port: 17986

resources:
  - secrets.yaml
  - init-scripts.yaml
  - init-job.yaml
