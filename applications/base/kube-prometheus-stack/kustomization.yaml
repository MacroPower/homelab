apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: observability

helmCharts:
  - name: kube-prometheus-stack
    repo: https://prometheus-community.github.io/helm-charts
    version: 41.9.1
    releaseName: kube-prometheus-stack
    namespace: observability
    includeCRDs: true
    valuesInline:
      global:
        rbac:
          create: true
          createAggregateClusterRoles: true

      grafana:
        enabled: false
        forceDeployDatasources: true
        forceDeployDashboards: true

      kubeStateMetrics:
        enabled: true

      nodeExporter:
        enabled: true

      prometheusOperator:
        admissionWebhooks:
          certManager:
            enabled: true
        prometheusConfigReloader:
          resources:
            requests:
              cpu: 10m
              memory: 50Mi
            limits:
              cpu: 200m
              memory: 50Mi

      prometheus:
        prometheusSpec:
          serviceMonitorSelectorNilUsesHelmValues: false
          serviceMonitorSelector: {}

          podMonitorSelectorNilUsesHelmValues: false
          podMonitorSelector: {}

          probeSelectorNilUsesHelmValues: false
          probeSelector: {}

          resources:
            requests:
              cpu: 100m
              memory: 2Gi
            limits:
              cpu: 1
              memory: 2Gi

      alertmanager:
        alertmanagerSpec:
          requests:
            cpu: 50m
            memory: 50Mi
          limits:
            cpu: 200m
            memory: 200Mi

      # # Max series is 10k.
      # prometheus:
      #   prometheusSpec:
      #     remoteWrite:
      #       - url: https://prometheus-us-central1.grafana.net/api/prom/push
      #         basicAuth:
      #           username:
      #             name: grafana-cloud-prom-credentials
      #             key: GRAFANA_PROM_USER
      #           password:
      #             name: grafana-cloud-prom-credentials
      #             key: GRAFANA_PROM_PASS
