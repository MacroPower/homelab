# https://github.com/grafana/mimir/tree/main/operations/helm/charts/mimir-distributed

mimir:
  structuredConfig:
    common:
      storage:
        backend: s3
    blocks_storage:
      s3:
        bucket_name: mimir-blocks
    alertmanager_storage:
      s3:
        bucket_name: mimir-alertmanager
    ruler_storage:
      s3:
        bucket_name: mimir-ruler
    limits:
      max_global_series_per_user: 0

alertmanager:
  persistentVolume:
    enabled: true
    storageClass: openebs-hostpath
  replicas: 2
  resources:
    limits:
      memory: 1.4Gi
    requests:
      cpu: 100m
      memory: 200Mi
  statefulSet:
    enabled: true

compactor:
  persistentVolume:
    size: 20Gi
    storageClass: openebs-hostpath
  resources:
    limits:
      memory: 2.1Gi
    requests:
      cpu: 100m
      memory: 300Mi

distributor:
  replicas: 2
  resources:
    limits:
      memory: 5.7Gi
    requests:
      cpu: 200m
      memory: 1Gi

ingester:
  persistentVolume:
    size: 50Gi
    storageClass: openebs-hostpath
  replicas: 3
  resources:
    limits:
      memory: 8Gi
    requests:
      cpu: 350m
      memory: 2Gi
  topologySpreadConstraints: {}
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - ingester
          topologyKey: topology.kubernetes.io/zone

  zoneAwareReplication:
    topologyKey: topology.kubernetes.io/zone

admin-cache:
  enabled: true
  replicas: 3

chunks-cache:
  enabled: true
  replicas: 3

index-cache:
  enabled: true
  replicas: 3

metadata-cache:
  enabled: true
  replicas: 3

results-cache:
  enabled: true
  replicas: 3

minio:
  enabled: false

overrides_exporter:
  replicas: 1
  resources:
    limits:
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 128Mi

querier:
  replicas: 1
  resources:
    limits:
      memory: 5.6Gi
    requests:
      cpu: 200m
      memory: 1Gi

query_frontend:
  replicas: 1
  resources:
    limits:
      memory: 2.8Gi
    requests:
      cpu: 200m
      memory: 500Mi

ruler:
  replicas: 1
  resources:
    limits:
      memory: 2.8Gi
    requests:
      cpu: 100m
      memory: 500Mi

store_gateway:
  persistentVolume:
    size: 10Gi
    storageClass: openebs-hostpath
  replicas: 3
  resources:
    limits:
      memory: 2.1Gi
    requests:
      cpu: 100m
      memory: 300Mi
  topologySpreadConstraints: {}
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - store-gateway
          topologyKey: topology.kubernetes.io/zone
  zoneAwareReplication:
    topologyKey: topology.kubernetes.io/zone

nginx:
  replicas: 1
  resources:
    limits:
      memory: 731Mi
    requests:
      cpu: 100m
      memory: 100Mi

metaMonitoring:
  serviceMonitor:
    enabled: true

  prometheusRule:
    mimirAlerts: true
    mimirRules: true
