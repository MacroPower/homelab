clusterName: home
talosVersion: v1.4.7
kubernetesVersion: v1.27.4
endpoint: https://kube.home.macro.network:6443
cniConfig:
  name: none

additionalMachineCertSans:
  - kube.home.macro.network

clusterSvcNets:
  - 10.112.0.0/12
  - 2603:6010:5300:ad70::/108
clusterPodNets:
  - 10.128.0.0/16
  - 2603:6010:5300:ad80::/64

nodes:
  - hostname: knode01.home.macro.network
    ipAddress: 10.10.10.1
    installDisk: /dev/mmcblk0
    controlPlane: true
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az01
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth0
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe10c6e45f016edba8

  - hostname: knode02.home.macro.network
    ipAddress: 10.10.10.2
    installDisk: /dev/mmcblk0
    controlPlane: true
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az02
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth0
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe0899e45f016ece7e

  - hostname: knode03.home.macro.network
    ipAddress: 10.10.10.3
    installDisk: /dev/mmcblk0
    controlPlane: true
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az03
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth0
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe1274e45f016ed058

  - hostname: knode13.home.macro.network
    ipAddress: 10.10.10.13
    installDisk: /dev/sda
    controlPlane: false
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az01
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth4
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe19fa0002c956fe52

  - hostname: knode14.home.macro.network
    ipAddress: 10.10.10.14
    installDisk: /dev/sda
    controlPlane: false
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az02
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth4
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe19f50002c956d1a4

  - hostname: knode15.home.macro.network
    ipAddress: 10.10.10.15
    installDisk: /dev/sda
    controlPlane: false
    nodeLabels:
      topology.kubernetes.io/region: rack01
      topology.kubernetes.io/zone: az03
    nameservers:
      - 10.0.0.1
    networkInterfaces:
      - interface: eth4
        dhcp: true
        dhcpOptions:
          ipv4: true
          ipv6: true
          duidv6: 000100012cfe19fc0002c9530a86

controlPlane:
  inlinePatch:
    cluster:
      aescbcEncryptionSecret: ${AESCBC_ENCRYPTION_KEY}
      secretboxEncryptionSecret: ${SECRETBOX_ENCRYPTION_KEY}
      aggregatorCA:
        crt: ${K8S_AGGREGATOR_CERT}
        key: ${K8S_AGGREGATOR_CERT_KEY}
      apiServer:
        disablePodSecurityPolicy: true
        admissionControl: []
      ca:
        crt: ${K8S_CERT}
        key: ${K8S_CERT_KEY}
      controllerManager:
        extraArgs:
          bind-address: 0.0.0.0
          ## Node CIDR mask size for IPv4 and IPv6.
          ## Note that the clusterPodNets must be the same or a greater size,
          ## which will be the same or a smaller number.
          ##
          node-cidr-mask-size-ipv4: "16"
          node-cidr-mask-size-ipv6: "64"
      etcd:
        ca:
          crt: ${ETCD_CERT}
          key: ${ETCD_CERT_KEY}
        extraArgs:
          listen-metrics-urls: http://0.0.0.0:2381
      scheduler:
        extraArgs:
          bind-address: 0.0.0.0
      proxy:
        # Replaced by Cillium.
        disabled: true
      id: ${CLUSTER_ID}
      secret: ${CLUSTER_SECRET}
      serviceAccount:
        key: ${K8S_SERVICEACCOUNT_KEY}
      token: ${CLUSTER_TOKEN}
    machine:
      ca:
        crt: ${OS_CERT}
        key: ${OS_CERT_KEY}
      kubelet:
        extraArgs:
          feature-gates: GracefulNodeShutdown=true,MixedProtocolLBService=true
          rotate-server-certificates: true
      token: ${TRUSTEDINFO_TOKEN}
      install:
        extraKernelArgs:
          - "talos.logging.kernel=udp://syslog.home.macro.network:6050/"
      logging:
        destinations:
          - endpoint: "udp://syslog.home.macro.network:6051/"
            format: json_lines

worker:
  inlinePatch:
    cluster:
      aescbcEncryptionSecret: ${AESCBC_ENCRYPTION_KEY}
      ca:
        crt: ${K8S_CERT}
        key: ${K8S_CERT_KEY}
      id: ${CLUSTER_ID}
      secret: ${CLUSTER_SECRET}
      token: ${CLUSTER_TOKEN}
    machine:
      ca:
        crt: ${OS_CERT}
        key: ${OS_CERT_KEY}
      certSANs:
        - kube.home.macro.network
      kubelet:
        extraArgs:
          feature-gates: GracefulNodeShutdown=true,MixedProtocolLBService=true
          rotate-server-certificates: true
      token: ${TRUSTEDINFO_TOKEN}
      install:
        extraKernelArgs:
          - "talos.logging.kernel=udp://syslog.home.macro.network:6050/"
      logging:
        destinations:
          - endpoint: "udp://syslog.home.macro.network:6051/"
            format: json_lines
