---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  dep-up:
    internal: true
    desc: Update Helm chart dependencies
    requires:
      vars: [CHART_PATH]
    preconditions:
      - &requireHelmCli
        sh: command -v helm
        msg: |
          Helm CLI not found, you can install it with:

          brew install helm
    cmds:
      - helm dependency update {{.CHART_PATH}}

  lint-chart:
    desc: Lint Helm chart
    requires:
      vars: [CHART_PATH, PARAMS]
    preconditions:
      - *requireHelmCli
    deps:
      - task: dep-up
        vars:
          CHART_PATH: "{{.CHART_PATH}}"
    cmds:
      - >-
        helm lint {{.CHART_PATH}} -f {{.CHART_PATH}}/values.yaml --with-subcharts {{.PARAMS}}
